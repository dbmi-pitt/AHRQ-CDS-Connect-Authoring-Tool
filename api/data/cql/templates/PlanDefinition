{
    "resourceType": "Bundle",
    "type": "transaction",
    "entry": [
	{
	    "resource": {
		"resourceType": "PlanDefinition",
		"id": "<%-element_id%>",
		"version": "<%-element_version%>",
		"name": "PlanDefinition - <%-element_name%>",
		"title": "<%-element_name%>",
		"type": {
		    "coding": [
			{
			    "system": "http://hl7.org/fhir/plan-definition-type",
			    "code": "eca-rule",
			    "display": "ECA Rule"
			}
		    ]
		},
		"status": "draft",
		"url": "http://hl7.org/fhir/ig/PDDI-CDS/PlanDefinition/<%-element_id%>",
		"topic": [
		    {
			"text": "<%-element_topic%>"
		    }
		],
		"library": [
		    {
			"reference": "Library/<%-element_id%>"
		    }
		],
		"relatedArtifact": [
		    {
			"type": "<%-element_related_artifact_type%>",
			"display": "<%-element_related_artifact_name%>",
			"url": "<%-element_related_artifact_url%>"
		    }
		],
		"action": [
          {
            "triggerDefinition": [
              {
                "type": "named-event",
                "eventName": "patient-view"
              }
            ],
            "condition": [
              {
                "kind": "applicability",
                "language": "text/cql",
                "expression": "InPopulation"
              }
            ],
            <% if (element_recommendations) {%>
                "action": [
                    <% element_recommendations.forEach(function(r, idx, array){ %>
                    <% if(planDefinitionRecommendations.includes(r.text)){ %>
                    {
                        "title": "<%-r.text%>",
                        "description": "<%-r.rationale%>",
                        "condition": [
                        <% r.subpopulations.forEach(subpopulation => { %>
                            {
                                "kind": "applicability",
                                "language": "text/cql",
                                "expression": "<%-subpopulation.subpopulationName%>"
                            }
                        <% }); %>
                        ],
                        "dynamicValue": [
                          {
                            "path": "activity.extension",
                            "expression": "Indicator"
                          }
                        ],
                        "action": [
                            {
                                "label": "<%-r.classification%>"
                            }
                        ]
                    }
                    <% if(idx < array.length -1) {%> , <% } %>
                    <% } %>

                    <% }); %>
                ]
            <% } %>
            }
            ]
		}
	}
	]
}